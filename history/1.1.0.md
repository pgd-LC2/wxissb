# 版本 1.1.0 更新日志

**发布日期**: 2026-01-22

## 新增功能

### 排行榜系统增强

**功能描述**：
- 为排行榜添加版本标记功能，区分新旧版本数据
- 支持多种排序方式（战力、等级、存活时间、击杀数）
- 将去重逻辑从前端移至数据库层级，通过 Edge Function 实现

**实现方案**：

1. **数据库迁移**
   - 为 `leaderboard` 表添加 `last` 布尔字段
   - 所有现有数据标记为 `last=true`（旧版本数据）
   - 新提交的分数默认 `last=false`（当前版本数据）

2. **Edge Function (get-leaderboard)**
   - 支持参数：
     - `sort_by`: 排序字段 (score/level/survival_time/kills)
     - `include_last`: 是否包含旧版本数据
     - `limit`: 返回数量限制
     - `offset`: 分页偏移
   - 在服务端进行玩家去重（每个玩家只保留最高分记录）
   - 返回总数用于分页显示

3. **前端更新**
   - 添加排序方式下拉选择器
   - 添加"显示旧版本数据"开关
   - 旧版本数据显示橙色"旧版"标签
   - 状态栏显示当前排序方式和版本过滤状态

**修改文件**：
- `js/supabase.js` - 添加 `getLeaderboardAdvanced` 方法，调用 Edge Function
- `pages/leaderboard.html` - 添加筛选控件和样式
- `supabase/functions/get-leaderboard/index.ts` - 新增 Edge Function

**数据库变更**：
- `leaderboard` 表新增 `last` 字段 (BOOLEAN, 默认 false)

**相关 PR**：
- 待创建
