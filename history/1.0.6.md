# 版本 1.0.6 - 怪物生成平衡优化

## 更新日期
2026-01-21

## 更新内容

### 怪物生成系统重构
使用动态公式替代原有的线性公式，解决"前期怪太多后期太少"的问题。

### 核心改动

#### 目标怪物数量公式
使用非线性函数实现平滑的难度曲线：
- **时间因子**：`Math.pow(timeProg, 0.6)` - 让前期增长更平缓
- **等级因子**：`Math.sqrt(level)` - 使用平方根减缓等级带来的增长
- **战力因子**：`Math.pow(strength, 1.3)` - 让高战力时怪物更多

预期效果：
- 前期（刚开始）：约 6 只怪物
- 中期（2分钟左右）：约 22 只怪物
- 后期（4分钟以上）：约 55+ 只怪物

#### 生成速率公式
同样使用非线性增长：
- 前期：约 0.8 只/秒
- 后期：约 7 只/秒

#### 密度反馈优化
使用平滑的乘数替代硬编码的倍率：
- 怪物太少时：`rate *= 1.0 + (0.7 - densityRatio) * 0.8`
- 怪物太多时：`rate *= max(0.15, 1.0 - (densityRatio - 1.15) * 0.6)`

## 技术细节

修改文件：`js/core/gameFactory.js` 中的 `directorStep` 函数

旧公式（线性）：
```javascript
d.targetEnemies = Math.round(12 + g.level * 1.0 + strength * 20);
let rate = clamp(1.2 + g.level * 0.08 + strength * 2.4, 0.8, 8.0);
```

新公式（非线性）：
```javascript
const timeScale = Math.pow(timeProg, 0.6);
const levelScale = Math.sqrt(Math.max(1, g.level));
const strengthScale = Math.pow(strength, 1.3);
d.targetEnemies = Math.round(6 + timeScale * 18 + levelScale * 2.5 + strengthScale * 22);
```
